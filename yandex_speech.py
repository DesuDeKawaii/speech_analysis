import requests
import json
import time
import base64
import random
from typing import Dict, Optional
from pathlib import Path

from config import Config
from logger import logger


class YandexSpeechClient:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Yandex SpeechKit (async long audio).
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç API longRunningRecognize –¥–ª—è —Ñ–∞–π–ª–æ–≤ –¥–ª–∏–Ω–æ—é –±–æ–ª—å—à–µ 30 —Å–µ–∫—É–Ω–¥.
    –ê—É–¥–∏–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ base64 (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç Object Storage).
    
    –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
    https://cloud.yandex.ru/docs/speechkit/stt/api/transcribation-api
    """
    
    def __init__(self):
        self.api_key = Config.YANDEX_API_KEY
        self.folder_id = Config.YANDEX_FOLDER_ID
        
        # Async long-audio recognition
        self.stt_url = Config.SPEECHKIT_STT_URL
        self.operations_url = Config.SPEECHKIT_OPERATIONS_URL
        
        # –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –ø–æ–ª–ª–∏–Ω–≥–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
        self.poll_interval = 3       # —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
        self.poll_max_wait = 300     # –º–∞–∫—Å –æ–∂–∏–¥–∞–Ω–∏–µ (5 –º–∏–Ω)
    
    def analyze_audio(self, audio_path: str) -> Optional[Dict]:
        """–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ —Ñ–∞–π–ª —á–µ—Ä–µ–∑ SpeechKit async API.
        
        –®–∞–≥–∏:
        1. –ß–∏—Ç–∞–µ—Ç MP3 —Ñ–∞–π–ª –∏ –∫–æ–¥–∏—Ä—É–µ—Ç –≤ base64
        2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ longRunningRecognize
        3. –ü–æ–ª–ª–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        4. –°–æ–±–∏—Ä–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –∏–∑ —á–∞–Ω–∫–æ–≤
        
        Args:
            audio_path: –ü—É—Ç—å –∫ MP3 —Ñ–∞–π–ª—É
            
        Returns:
            dict —Å –ø–æ–ª—è–º–∏: transcript, sentiment, statistics
        """
        logger.info(f"üìû –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ–º –∞—É–¥–∏–æ: {Path(audio_path).name}")
        
        # –®–∞–≥ 1: –ß–∏—Ç–∞–µ–º –∏ –∫–æ–¥–∏—Ä—É–µ–º —Ñ–∞–π–ª
        file_path = Path(audio_path)
        if not file_path.exists():
            logger.error(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {audio_path}")
            return None
        
        file_size_mb = file_path.stat().st_size / (1024 * 1024)
        logger.info(f"   –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {file_size_mb:.1f} –ú–ë")
        
        with open(audio_path, 'rb') as f:
            audio_content = base64.b64encode(f.read()).decode('utf-8')
        
        # –®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
        operation_id = self._start_recognition(audio_content)
        
        if not operation_id:
            logger.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ")
            return None
        
        logger.info(f"   üîÑ –û–ø–µ—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: {operation_id}")
        
        # –®–∞–≥ 3: –ñ–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        result = self._wait_for_result(operation_id)
        
        if not result:
            logger.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è")
            return None
        
        # –®–∞–≥ 4: –°–æ–±–∏—Ä–∞–µ–º —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç
        transcript = self._extract_transcript(result)
        
        if not transcript:
            logger.warning("‚ö†Ô∏è –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –ø—É—Å—Ç (–≤–æ–∑–º–æ–∂–Ω–æ, –≤ –∞—É–¥–∏–æ –Ω–µ—Ç —Ä–µ—á–∏)")
            return None
        
        logger.info(f"‚úÖ –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ({len(transcript)} —Å–∏–º–≤–æ–ª–æ–≤)")
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å processor.py
        # SpeechKit –Ω–µ –¥–∞—ë—Ç –∞–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–π ‚Äî —ç—Ç–æ –¥–µ–ª–∞–µ—Ç GPT –ø–æ —Ç–µ–∫—Å—Ç—É
        return {
            "transcript": transcript,
            "sentiment": {
                "operator": "neutral",  # SpeechKit –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç–º–æ—Ü–∏–∏
                "client": "neutral"
            },
            "statistics": {
                "interruptions": 0,
                "speech_rate": "normal"
            }
        }
    
    def _start_recognition(self, audio_base64: str) -> Optional[str]:
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç async —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç operation_id.
        
        Returns:
            str: ID –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
        """
        headers = {
            "Authorization": f"Api-Key {self.api_key}",
            "Content-Type": "application/json"
        }
        
        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è MP3 (—Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –æ–±—ã—á–Ω–æ 8kHz –º–æ–Ω–æ)
        payload = {
            "config": {
                "specification": {
                    "languageCode": "ru-RU",
                    "model": "general",         # –û–±—â–∞—è –º–æ–¥–µ–ª—å
                    "profanityFilter": False,    # –ù–µ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –º–∞—Ç (–Ω—É–∂–µ–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)
                    "audioEncoding": "MP3",
                    "sampleRateHertz": 48000,    # SpeechKit —Å–∞–º –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è
                    "audioChannelCount": 1,      # –ú–æ–Ω–æ (—Ç–µ–ª–µ—Ñ–æ–Ω–∏—è)
                    "rawResults": False,         # –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    "literature_text": True      # –ü—É–Ω–∫—Ç—É–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
                },
                "folderId": self.folder_id
            },
            "audio": {
                "content": audio_base64
            }
        }
        
        for attempt in range(Config.RETRY_ATTEMPTS):
            try:
                response = requests.post(
                    self.stt_url,
                    headers=headers,
                    json=payload,
                    timeout=60
                )
                
                if response.status_code == 200:
                    data = response.json()
                    return data.get("id")
                    
                elif response.status_code == 429:
                    logger.warning("‚è≥ Rate limit, –∂–¥—ë–º 5 —Å–µ–∫...")
                    time.sleep(5)
                    continue
                else:
                    logger.error(
                        f"SpeechKit error ({response.status_code}): "
                        f"{response.text[:300]}"
                    )
                    
            except requests.exceptions.Timeout:
                logger.warning(f"‚è≥ –¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
                time.sleep(2)
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ SpeechKit (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}): {e}")
                if attempt < Config.RETRY_ATTEMPTS - 1:
                    time.sleep(2)
        
        return None
    
    def _wait_for_result(self, operation_id: str) -> Optional[dict]:
        """–ü–æ–ª–ª–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
        
        Args:
            operation_id: ID –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç longRunningRecognize
            
        Returns:
            dict: –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ/—Ç–∞–π–º–∞—É—Ç–µ
        """
        headers = {
            "Authorization": f"Api-Key {self.api_key}",
        }
        
        url = f"{self.operations_url}/{operation_id}"
        elapsed = 0
        
        while elapsed < self.poll_max_wait:
            try:
                response = requests.get(url, headers=headers, timeout=30)
                
                if response.status_code != 200:
                    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏: {response.status_code}")
                    return None
                
                data = response.json()
                
                if data.get("done"):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫—É
                    if "error" in data:
                        error = data["error"]
                        logger.error(
                            f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: "
                            f"[{error.get('code')}] {error.get('message')}"
                        )
                        return None
                    
                    return data.get("response", {})
                
                # –ï—â—ë –Ω–µ –≥–æ—Ç–æ–≤–æ ‚Äî –∂–¥—ë–º
                logger.info(f"   ‚è≥ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ... ({elapsed}—Å)")
                time.sleep(self.poll_interval)
                elapsed += self.poll_interval
                
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª–ª–∏–Ω–≥–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: {e}")
                time.sleep(self.poll_interval)
                elapsed += self.poll_interval
        
        logger.error(f"‚ùå –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ({self.poll_max_wait}—Å)")
        return None
    
    def _extract_transcript(self, response_data: dict) -> str:
        """–°–æ–±–∏—Ä–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –∏–∑ —á–∞–Ω–∫–æ–≤ –æ—Ç–≤–µ—Ç–∞ SpeechKit.
        
        SpeechKit –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ —á–∞–Ω–∫–∞–º (chunks), 
        –∫–∞–∂–¥—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç alternatives —Å —Ç–µ–∫—Å—Ç–æ–º.
        
        Args:
            response_data: –û—Ç–≤–µ—Ç SpeechKit (–ø–æ–ª–µ response –∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–∏)
            
        Returns:
            str: –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞
        """
        chunks = response_data.get("chunks", [])
        
        if not chunks:
            return ""
        
        transcript_parts = []
        
        for chunk in chunks:
            alternatives = chunk.get("alternatives", [])
            if alternatives:
                # –ë–µ—Ä—ë–º –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç (–ø–µ—Ä–≤—ã–π)
                best = alternatives[0]
                text = best.get("text", "").strip()
                if text:
                    transcript_parts.append(text)
        
        return " ".join(transcript_parts)
    
    def analyze_audio_mock(self, audio_path: str) -> Dict:
        """–ú–æ–∫–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ë–ï–ó —Ä–µ–∞–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤.
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –¥–∏–∞–ª–æ–≥–∞ L7 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ GPT-–ø—Ä–æ–º–ø—Ç–∞.
        """
        logger.info(f"üé≠ MOCK: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ–º –∞—É–¥–∏–æ {Path(audio_path).name}")
        
        # –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ mock-–¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
        dialogs = [
            # –•–æ—Ä–æ—à–∏–π –¥–∏–∞–ª–æ–≥
            """–û–ø–µ—Ä–∞—Ç–æ—Ä: –ú–∞–º–º–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä L7, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å! –ú–µ–Ω—è –∑–æ–≤—É—Ç –ê–Ω–Ω–∞, —á–µ–º –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?
–ö–ª–∏–µ–Ω—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –£–ó–ò –º–æ–ª–æ—á–Ω—ã—Ö –∂–µ–ª–µ–∑.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ö–æ–Ω–µ—á–Ω–æ! –°–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã —Ä–∞–Ω–µ–µ –æ–±—Ä–∞—â–∞–ª–∏—Å—å –∫ –Ω–∞–º?
–ö–ª–∏–µ–Ω—Ç: –ù–µ—Ç, –ø–µ—Ä–≤—ã–π —Ä–∞–∑.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–æ–Ω—è—Ç–Ω–æ. –ê –∫–∞–∫–æ–π —É –≤–∞—Å –¥–µ–Ω—å —Ü–∏–∫–ª–∞? –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
–ö–ª–∏–µ–Ω—Ç: –ü—Ä–∏–º–µ—Ä–Ω–æ –¥–µ—Å—è—Ç—ã–π.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –û—Ç–ª–∏—á–Ω–æ, —ç—Ç–æ —Ö–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –£–ó–ò. –°–∫–∞–∂–∏—Ç–µ, –µ—Å—Ç—å –ª–∏ —É –≤–∞—Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç –≤—Ä–∞—á–∞ –∏–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏?
–ö–ª–∏–µ–Ω—Ç: –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏, –¥–∞–≤–Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ–ª–∞–µ—Ç–µ! –£ –Ω–∞—Å –≤ L7 —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–¥—É—â–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 15 –ª–µ—Ç, –∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ø–ø–∞—Ä–∞—Ç —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—è–≤–∏—Ç—å –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–∞–º–æ–π —Ä–∞–Ω–Ω–µ–π —Å—Ç–∞–¥–∏–∏. –ú–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–∞–º –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: –∑–∞–≤—Ç—Ä–∞ –≤ 10:00 –∏–ª–∏ –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞ –≤ 14:30. –ö–∞–∫–æ–π —É–¥–æ–±–Ω–µ–µ?
–ö–ª–∏–µ–Ω—Ç: –ó–∞–≤—Ç—Ä–∞ –≤ 10 –¥–∞–≤–∞–π—Ç–µ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ó–∞–ø–∏—Å–∞–ª–∞! –£–ó–ò –º–æ–ª–æ—á–Ω—ã—Ö –∂–µ–ª–µ–∑ —Å—Ç–æ–∏—Ç 2500 —Ä—É–±–ª–µ–π, –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Ö–æ–¥–∏—Ç –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä–∞—á–∞. –¢–∞–∫–∂–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Å—Ä–∞–∑—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –º–∞–º–º–æ–ª–æ–≥–∞ –ø–æ—Å–ª–µ –£–ó–ò ‚Äî —ç—Ç–æ 3000 —Ä—É–±–ª–µ–π. –í—Ä–∞—á —Å–º–æ–∂–µ—Ç —Å—Ä–∞–∑—É –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
–ö–ª–∏–µ–Ω—Ç: –î–∞, –¥–∞–≤–∞–π—Ç–µ –∏ –∫ –≤—Ä–∞—á—É —Ç–æ–∂–µ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –û—Ç–ª–∏—á–Ω–æ! –ò—Ç–æ–≥–æ: –∑–∞–≤—Ç—Ä–∞, 10:00 ‚Äî –£–ó–ò, 10:30 ‚Äî –ø—Ä–∏—ë–º –º–∞–º–º–æ–ª–æ–≥–∞. –ê–¥—Ä–µ—Å: —É–ª–∏—Ü–∞ –õ–µ–Ω–∏–Ω–∞, 45. –í–∞—à–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏?
–ö–ª–∏–µ–Ω—Ç: –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞, 8-999-123-45-67.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –°–ø–∞—Å–∏–±–æ, –ú–∞—Ä–∏—è! –ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –æ—Ç–∫—É–¥–∞ –≤—ã –æ –Ω–∞—Å —É–∑–Ω–∞–ª–∏?
–ö–ª–∏–µ–Ω—Ç: –í –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –Ω–∞—à–ª–∞.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–æ–Ω—è—Ç–Ω–æ, —Å–ø–∞—Å–∏–±–æ! –û—Å—Ç–∞–ª–∏—Å—å –ª–∏ —É –≤–∞—Å –µ—â—ë –∫–∞–∫–∏–µ-—Ç–æ –≤–æ–ø—Ä–æ—Å—ã?
–ö–ª–∏–µ–Ω—Ç: –ù–µ—Ç, –≤—Å—ë –ø–æ–Ω—è—Ç–Ω–æ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –¢–æ–≥–¥–∞ –∂–¥—ë–º –≤–∞—Å –∑–∞–≤—Ç—Ä–∞! –í—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ, –ú–∞—Ä–∏—è!""",
            
            # –°—Ä–µ–¥–Ω–∏–π –¥–∏–∞–ª–æ–≥ (–±–µ–∑ –≤–æ–ø—Ä–æ—Å–∞ –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–µ)
            """–û–ø–µ—Ä–∞—Ç–æ—Ä: –ê–ª–ª–æ, –∫–ª–∏–Ω–∏–∫–∞, —Å–ª—É—à–∞—é –≤–∞—Å.
–ö–ª–∏–µ–Ω—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—Ç–µ–ª–∞ –±—ã —É–∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∞–º–º–æ–≥—Ä–∞—Ñ–∏–∏.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ú–∞–º–º–æ–≥—Ä–∞—Ñ–∏—è —É –Ω–∞—Å —Å—Ç–æ–∏—Ç 3500 —Ä—É–±–ª–µ–π. –•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?
–ö–ª–∏–µ–Ω—Ç: –ê —ç—Ç–æ –±–æ–ª—å–Ω–æ?
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ù–µ—Ç, –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –±–µ–∑–±–æ–ª–µ–∑–Ω–µ–Ω–Ω–∞—è, –∑–∞–Ω–∏–º–∞–µ—Ç –æ–∫–æ–ª–æ 15 –º–∏–Ω—É—Ç.
–ö–ª–∏–µ–Ω—Ç: –õ–∞–¥–Ω–æ, –∑–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω—è.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ö–æ–≥–¥–∞ –≤–∞–º —É–¥–æ–±–Ω–æ?
–ö–ª–∏–µ–Ω—Ç: –í –ø—è—Ç–Ω–∏—Ü—É.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –í –ø—è—Ç–Ω–∏—Ü—É –≤ 11:00 –ø–æ–¥–æ–π–¥—ë—Ç?
–ö–ª–∏–µ–Ω—Ç: –î–∞.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –•–æ—Ä–æ—à–æ, –∑–∞–ø–∏—Å–∞–ª–∞. –î–æ —Å–≤–∏–¥–∞–Ω–∏—è.""",

            # –î–∏–∞–ª–æ–≥ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ–º
            """–û–ø–µ—Ä–∞—Ç–æ—Ä: –ú–∞–º–º–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä L7, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å, –º–µ–Ω—è –∑–æ–≤—É—Ç –ï–ª–µ–Ω–∞. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
–ö–ª–∏–µ–Ω—Ç: –î–æ–±—Ä—ã–π –¥–µ–Ω—å, –º–Ω–µ –Ω—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –º–∞–º–º–æ–ª–æ–≥–∞. –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç?
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –º–∞–º–º–æ–ª–æ–≥–∞ —Å—Ç–æ–∏—Ç 3000 —Ä—É–±–ª–µ–π. –°–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç?
–ö–ª–∏–µ–Ω—Ç: –ù—É, –Ω–∞—â—É–ø–∞–ª–∞ –∫–∞–∫–æ–µ-—Ç–æ —É–ø–ª–æ—Ç–Ω–µ–Ω–∏–µ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–æ–Ω–∏–º–∞—é –≤–∞—à—É —Ç—Ä–µ–≤–æ–≥—É. –°–∫–∞–∂–∏—Ç–µ, –∫–∞–∫ –¥–∞–≤–Ω–æ –≤—ã —ç—Ç–æ –∑–∞–º–µ—Ç–∏–ª–∏?
–ö–ª–∏–µ–Ω—Ç: –ù–µ–¥–µ–ª—é –Ω–∞–∑–∞–¥ –ø—Ä–∏–º–µ—Ä–Ω–æ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ê –≤—ã —Ä–∞–Ω–µ–µ –¥–µ–ª–∞–ª–∏ –£–ó–ò –∏–ª–∏ –º–∞–º–º–æ–≥—Ä–∞—Ñ–∏—é?
–ö–ª–∏–µ–Ω—Ç: –ì–æ–¥ –Ω–∞–∑–∞–¥ –¥–µ–ª–∞–ª–∞ –£–ó–ò, –≤—Å—ë –±—ã–ª–æ –≤ –Ω–æ—Ä–º–µ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –•–æ—Ä–æ—à–æ. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ–π—Ç–∏ –∏ –£–ó–ò, –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é. –ù–∞—à —Ü–µ–Ω—Ç—Ä ‚Äî –æ–¥–∏–Ω –∏–∑ –ª–∏–¥–µ—Ä–æ–≤ –≤ —ç—Ç–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏, —É –Ω–∞—Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ –≤—Ä–∞—á–∏ —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 20 –ª–µ—Ç.
–ö–ª–∏–µ–Ω—Ç: –≠—Ç–æ –¥–æ—Ä–æ–≥–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, 5500 –∑–∞ –≤—Å—ë...
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–æ–Ω–∏–º–∞—é. –ù–æ —É—á—Ç–∏—Ç–µ, —á—Ç–æ –≤ –Ω–∞—à–µ–º —Ü–µ–Ω—Ç—Ä–µ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞ –æ–¥–∏–Ω –≤–∏–∑–∏—Ç. –ù–µ –Ω—É–∂–Ω–æ –µ–∑–¥–∏—Ç—å –≤ —Ä–∞–∑–Ω—ã–µ –º–µ—Å—Ç–∞. –ü–ª—é—Å –Ω–∞—à–∏ –≤—Ä–∞—á–∏ —Å—Ä–∞–∑—É –¥–∞—é—Ç –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π. –≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –≤–∞—à–µ –≤—Ä–µ–º—è –∏ –Ω–µ—Ä–≤—ã.
–ö–ª–∏–µ–Ω—Ç: –ù—É –ª–∞–¥–Ω–æ, –¥–∞–≤–∞–π—Ç–µ –∑–∞–ø–∏—à–∏—Ç–µ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –û—Ç–ª–∏—á–Ω–æ! –ú–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å—Ä–µ–¥—É –≤ 9:00 –∏–ª–∏ —á–µ—Ç–≤–µ—Ä–≥ –≤ 15:00. –ß—Ç–æ —É–¥–æ–±–Ω–µ–µ?
–ö–ª–∏–µ–Ω—Ç: –°—Ä–µ–¥—É –¥–∞–≤–∞–π—Ç–µ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –ó–∞–ø–∏—Å–∞–ª–∞: —Å—Ä–µ–¥–∞, 9:00, –£–ó–ò + –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –º–∞–º–º–æ–ª–æ–≥–∞. –ù–∞—à –∞–¥—Ä–µ—Å ‚Äî –õ–µ–Ω–∏–Ω–∞ 45. –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?
–ö–ª–∏–µ–Ω—Ç: –û–ª—å–≥–∞.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –û–ª—å–≥–∞, –ø–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –æ—Ç–∫—É–¥–∞ –≤—ã –æ –Ω–∞—Å —É–∑–Ω–∞–ª–∏?
–ö–ª–∏–µ–Ω—Ç: –ü–æ–¥—Ä—É–≥–∞ –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª–∞.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ! –ï—Å—Ç—å –ª–∏ –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã?
–ö–ª–∏–µ–Ω—Ç: –ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ.
–û–ø–µ—Ä–∞—Ç–æ—Ä: –¢–æ–≥–¥–∞ –∂–¥—ë–º –≤–∞—Å –≤ —Å—Ä–µ–¥—É! –í—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ, –û–ª—å–≥–∞!"""
        ]
        
        transcript = random.choice(dialogs)
        
        return {
            "transcript": transcript,
            "sentiment": {
                "operator": random.choice(["positive", "neutral"]),
                "client": random.choice(["positive", "neutral", "negative"])
            },
            "statistics": {
                "interruptions": random.randint(0, 3),
                "speech_rate": "normal"
            }
        }


# Singleton instance
speech_client = YandexSpeechClient()
