# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∑–≤–æ–Ω–∫–æ–≤

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–≤–æ–Ω–∫–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∫–æ–ª–ª-—Ü–µ–Ω—Ç—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Yandex SpeechSense –∏ YandexGPT.

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

1. **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ**: –°–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–æ–≤ –∏–∑ –ê–¢–° –ú–µ–≥–∞—Ñ–æ–Ω
2. **–ö–∞–∂–¥—ã–µ 2 –Ω–µ–¥–µ–ª–∏** (15-–≥–æ –∏ –≤ –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞):
   - –í—ã–±–∏—Ä–∞–µ—Ç 2000 –º–∏–Ω—É—Ç –∑–≤–æ–Ω–∫–æ–≤ (—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏)
   - –°–∫–∞—á–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ Yandex SpeechSense (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è + —ç–º–æ—Ü–∏–∏)
   - –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ YandexGPT
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Excel –æ—Ç—á–µ—Ç
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ email

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- –î–æ—Å—Ç—É–ø –∫ API –ú–µ–≥–∞—Ñ–æ–Ω –ê–¢–°
- Yandex Cloud –∞–∫–∫–∞—É–Ω—Ç (SpeechSense + YandexGPT)
- SMTP –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cp .env.example .env
nano .env  # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `MEGAFON_HOST` - URL API –ú–µ–≥–∞—Ñ–æ–Ω –ê–¢–°
- `MEGAFON_KEY` - –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ –ê–¢–°
- `YANDEX_FOLDER_ID` - ID –ø–∞–ø–∫–∏ –≤ Yandex Cloud
- `YANDEX_API_KEY` - API –∫–ª—é—á Yandex Cloud

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–¥–ª—è email):**
- `SMTP_USER`, `SMTP_PASSWORD`, `EMAIL_TO`

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
python -c "from database import init_db; init_db()"
```

### 4. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (—Å mock –¥–∞–Ω–Ω—ã–º–∏)

```bash
python reporter.py --mock --first-half
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç –ë–ï–ó —Ä–µ–∞–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Yandex.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
speech_analysis/
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ database.py            # –ú–æ–¥–µ–ª–∏ –ë–î
‚îú‚îÄ‚îÄ logger.py              # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ megafon.py            # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ê–¢–° –ú–µ–≥–∞—Ñ–æ–Ω
‚îú‚îÄ‚îÄ yandex_speech.py      # Yandex SpeechSense API
‚îú‚îÄ‚îÄ yandex_gpt.py         # YandexGPT API
‚îú‚îÄ‚îÄ call_selector.py      # –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –∑–≤–æ–Ω–∫–æ–≤
‚îú‚îÄ‚îÄ processor.py          # Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ main.py               # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Excel
‚îú‚îÄ‚îÄ email_sender.py       # –û—Ç–ø—Ä–∞–≤–∫–∞ email
‚îú‚îÄ‚îÄ reporter.py           # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ receiver.py           # Webhook –¥–ª—è –ê–¢–°
‚îú‚îÄ‚îÄ Template.xlsx         # –®–∞–±–ª–æ–Ω –æ—Ç—á–µ—Ç–∞
‚îú‚îÄ‚îÄ .env                  # –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ (–ù–ï –≤ git!)
‚îî‚îÄ‚îÄ requirements.txt      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## üîÑ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

**–î–ª—è –ø–µ—Ä–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –º–µ—Å—è—Ü–∞ (1-15):**
```bash
python reporter.py --first-half
```

**–î–ª—è –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –º–µ—Å—è—Ü–∞ (16-–∫–æ–Ω–µ—Ü):**
```bash
python reporter.py --second-half
```

**–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞:**
```bash
python reporter.py
```

**–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (mock):**
```bash
python reporter.py --mock
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (cron)

**Linux/Mac:**
```bash
chmod +x setup_cron.sh
./setup_cron.sh
```

**Windows (Task Scheduler):**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Task Scheduler
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É –¥–ª—è:
   - 15-–≥–æ —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤ 9:00
   - –ü–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞ –≤ 9:00
3. –î–µ–π—Å—Ç–≤–∏–µ: `python C:\path\to\reporter.py --first-half`

### Webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –∑–≤–æ–Ω–∫–æ–≤

–ó–∞–ø—É—Å—Ç–∏—Ç–µ webhook-—Å–µ—Ä–≤–µ—Ä:
```bash
python receiver.py
```

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ –ê–¢–° –ú–µ–≥–∞—Ñ–æ–Ω URL –≤–µ–±—Ö—É–∫–∞ –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä (—á–µ—Ä–µ–∑ ngrok –¥–ª—è —Ç–µ—Å—Ç–æ–≤).

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞

### –õ–∏—Å—Ç 1: –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–≤–æ–Ω–∫–∞:
- –û–ø–µ—Ä–∞—Ç–æ—Ä, –¥–∞—Ç–∞, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û—Ü–µ–Ω–∫–∏ GPT (1-10): –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏, –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è, –í–æ–∑—Ä–∞–∂–µ–Ω–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ª—É–≥, –±–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã
- –ê–Ω–∞–ª–∏–∑ –ò–ò, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –õ–∏—Å—Ç 2: –û–±—â–∏–π –æ—Ç—á–µ—Ç
–°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –∑–≤–æ–Ω–∫–∞–º
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º
- –°—Ä–µ–¥–Ω–∏–π KPI, —Å—Ç–∞—Ç—É—Å (–ó–æ–ª–æ—Ç–æ–π/–°–µ—Ä–µ–±—Ä—è–Ω—ã–π/–ú–µ–¥–Ω—ã–π)
- **–ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç GPT** (–æ–±–æ–±—â–µ–Ω–∏–µ –ø–æ –≤—Å–µ–º –∑–≤–æ–Ω–∫–∞–º)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∏–Ω—É—Ç

–í `.env`:
```
ANALYSIS_MINUTES_TARGET=2000
```

–ò–ª–∏ –≤ –∫–æ–¥–µ (`config.py`).

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏ GPT

–í `.env`:
```
YANDEX_GPT_MODEL=yandexgpt-lite    # –î–µ—à–µ–≤–ª–µ, –±—ã—Å—Ç—Ä–µ–µ
# –∏–ª–∏
YANDEX_GPT_MODEL=yandexgpt         # –£–º–Ω–µ–µ, –¥–æ—Ä–æ–∂–µ
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
cat logs/processing_YYYYMMDD.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
sqlite3 calls.db "SELECT operator, status, COUNT(*) FROM calls GROUP BY operator, status;"
```

### –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Yandex

```python
from yandex_gpt import gpt_client
result = gpt_client.analyze_call("–¢–µ—Å—Ç–æ–≤—ã–π –¥–∏–∞–ª–æ–≥...", {"operator": "neutral", "client": "positive"})
print(result)
```

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ 2000 –º–∏–Ω—É—Ç –∫–∞–∂–¥—ã–µ 2 –Ω–µ–¥–µ–ª–∏:
- **SpeechSense**: ~‚ÇΩ1600 –∑–∞ –æ—Ç—á–µ—Ç
- **YandexGPT**: ~‚ÇΩ50 –∑–∞ –æ—Ç—á–µ—Ç
- **–ò–¢–û–ì–û**: ~‚ÇΩ3300-4000/–º–µ—Å—è—Ü

–î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π SpeechKit (~‚ÇΩ400 –∑–∞ –æ—Ç—á–µ—Ç) –≤–º–µ—Å—Ç–æ SpeechSense, –Ω–æ –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞ —ç–º–æ—Ü–∏–π.

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "YANDEX_API_KEY not found"
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`

### Excel —Ñ–∞–π–ª –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–∫—Ä—ã–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–∞ `Report_*.xlsx`

### –ù–µ—Ç –∑–≤–æ–Ω–∫–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. Webhook –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
2. –í –ë–î –µ—Å—Ç—å –∑–≤–æ–Ω–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `NEW`
3. –ü–µ—Ä–∏–æ–¥ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### GPT –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç –≤ `yandex_gpt.py`, —Ñ—É–Ω–∫—Ü–∏—è `analyze_call()`

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `logs/processing_*.log`

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
